/*!
 * Posts Table Pro 2.4.1
 * Copyright 2022 Barn2 Plugins
 */
!function(t,e,a,l){"use strict";const i={message:null,overlayCSS:{background:"#fff",opacity:.7}};function n(t){return function(e,a){"class"===e?t.addClass(a):t.attr(e,a)}}function s(e,a,l){l=void 0!==l?l:0,t.each(a,(function(t,a){let i=a.name,n="slug"in a?a.slug:i,r="";l&&(r=Array(2*l+1).join(" ")+"– "),e.append('<option value="'+n+'">'+r+i+"</option>"),"children"in a&&s(e,a.children,l+1)}))}function r(a){a&&a.length&&("undefined"!=typeof WPPlaylistView&&a.find(".wp-playlist").filter((function(){return 0===t(".mejs-container",this).length})).each((function(){return new WPPlaylistView({el:this})})),"wp"in e&&"mediaelement"in e.wp&&t(e.wp.mediaelement.initialize),t.fn.fitVids&&a.fitVids())}function o(t,e){let a,l=JSON.parse(JSON.stringify(t));for(let t=l.length-1;t>=0;t--)a=l[t],a.hasOwnProperty("children")&&(a.children=o(a.children,e),0===a.children.length&&delete a.children),-1!==e.indexOf(a.slug)||a.hasOwnProperty("children")||l.splice(t,1);return l}function p(){return"select2"in t.fn&&posts_table_params.enable_select2}let d=function(a){this.$table=a,this.id=a.attr("id"),this.dataTable=null,this.config=null,this.ajaxData=[],this.hasAdminBar=t("#wpadminbar").length>0,this.$filters=[],this.$tableWrapper=[],this.$pagination=[],this.$tableControls=[],a.on("draw.dt",{table:this},h).on("init.dt",{table:this},g).on("page.dt",{table:this},m).on("processing.dt",{table:this},_).on("responsive-display.dt",{table:this},v).on("xhr.dt",{table:this},c),t(e).on("load.ptp",{table:this},y),a.addClass("loading").css("visibility","visible")};function c(e,a,l,i){let n=e.data.table;null!==l&&"data"in l&&t.isArray(l.data)&&(n.ajaxData=l.data),n.$table.trigger("lazyload.ptp",[n])}function f(e){let a=t(this),l=e.data.table,i=l.getDataTable(),n=a.closest("td");n.hasClass("child")&&(n=a.closest("[data-dt-column]",n));let s=i.column(n.get(0));if(!s.length)return!0;let r=t(s.header());if(!r.data("clickFilter"))return!0;e.preventDefault();let o=a.text(),p=r.data("name"),d=l.$filters&&l.$filters.length?l.$filters.filter('[data-column="'+p+'"]'):[];return d.length&&(i.column(d.first().data("searchColumn")+":name").search(""),t("option",d).filter((function(){return t.trim(t(this).text().replace("–",""))===o})).prop("selected",!0).trigger("change",[!0])),l.config.serverSide?s.search(o).draw():(o="(^|, )"+t.fn.dataTable.util.escapeRegex(o)+"(, |$)",s.search(o,!0,!1).draw()),l.scrollToTop(),!1}function h(t){let e=t.data.table;var a;e.config.serverSide&&e.processAjaxData(),!e.config.serverSide&&e.$table.hasClass("loading")||r(e.$table),a=e.$table,"undefined"!=typeof PhotoSwipe&&"undefined"!=typeof PhotoSwipeUI_Default&&a.find(".posts-table-gallery__image a").off("click.ptp").on("click.ptp",b),e.showHidePagination().$table.trigger("draw.ptp",[e])}function u(e,a){let l=t(this),i=e.data.table;if(a)return!0;let n=l.val(),s=l.data("column"),r=i.getDataTable().column(l.data("searchColumn")+":name");if(i.config.serverSide)r.search(n).draw();else{let e=n?"(^| )"+t.fn.dataTable.util.escapeRegex(n)+"( |$)":"";r.search(e,!0,!1).draw()}let o=i.$filters.filter('[data-column="'+s+'"]'),p=i.$filters.not(o);o.not(l[0]).val(n).trigger("change",[!0]),i.config.serverSide||p.each((function(){i.refreshFilterItems(t(this))}))}function g(e){let a=e.data.table;a.$tableWrapper=a.$table.parent(),a.$pagination=a.$tableWrapper.find(".dataTables_paginate"),a.$tableControls=a.$tableWrapper.find(".posts-table-controls"),a.initFilters().initSelect2().initResetButton().initSearchOnClick().initPhotoswipe().showHidePagination(),!a.config.serverSide&&t.fn.fitVids&&a.$table.fitVids(),a.$table.removeClass("loading").trigger("init.ptp",[a])}function b(e){if(e.stopPropagation(),"click"!==e.type)return!1;let a=t(".pswp")[0],l=t(e.target).closest(".posts-table-gallery__image"),i=[];return l.length>0&&l.each((function(e,a){let l=t(a).find("img"),n={src:l.attr("data-large_image"),w:l.attr("data-large_image_width"),h:l.attr("data-large_image_height"),title:l.attr("data-caption")&&l.attr("data-caption").length?l.attr("data-caption"):l.attr("title")};i.push(n)})),new PhotoSwipe(a,PhotoSwipeUI_Default,i,{index:0,shareEl:!1,closeOnScroll:!1,history:!1,hideAnimationDuration:0,showAnimationDuration:0}).init(),!1}function m(t){t.data.table.scrollToTop()}function _(t,e,a){a?t.data.table.$table.block(i):t.data.table.$table.unblock()}function $(e){e.preventDefault();let a=e.data.table,l=a.getDataTable();a.$table.find("tr.child").remove(),a.$table.find("tr.parent").removeClass("parent"),l.columns('th[data-searchable="true"]').search("");let i=a.$table.attr("data-order");if(i.length){let t=i.replace(/[\[\]\" ]+/g,"").split(",");2===t.length&&l.order(t)}a.$filters.length&&(a.$filters.val("").trigger("change",[!0]),a.config.serverSide||a.$filters.each((function(){a.refreshFilterItems(t(this))})));let n="search"in a.config&&"search"in a.config.search?a.config.search.search:"";l.search(n).page.len(a.config.pageLength).draw(!0),p()&&a.$tableControls.find(".dataTables_length select").trigger("change")}function v(t,e,a,l,i){if(l&&void 0!==a.child()){r(a.child());let i=t.data.table;i.$table.trigger("responsive-display.ptp",[i,a.child()]),i.$table.trigger("responsiveDisplay.ptp",[i,e,a,l])}}function y(t){let e=t.data.table;e.getDataTable().columns.adjust().responsive.recalc(),e.$table.trigger("load.ptp",[e])}d.prototype.buildConfig=function(){let e={retrieve:!0,responsive:!0,processing:!0,orderMulti:!1,language:posts_table_params.language},a=this.$table.data("config");var l;return a&&(e=t.extend(!0,{},e,a)),-1!==e.language.info.indexOf(posts_table_params.language.totalsPlural)&&(e.infoCallback=function(t,e,a,l,i,n){return n&&1===i?n.replace(posts_table_params.language.totalsPlural,posts_table_params.language.totalsSingle):n}),e.serverSide&&"ajax_url"in posts_table_params&&(e.deferRender=!0,e.ajax={url:posts_table_params.ajax_url,type:"POST",data:{table_id:this.id,action:posts_table_params.ajax_action,_ajax_nonce:posts_table_params.ajax_nonce},xhrFields:{withCredentials:!0}}),"responsive"in e&&"object"==typeof e.responsive&&"details"in e.responsive&&"display"in e.responsive.details&&("child_row_visible"===e.responsive.details.display?(e.responsive.details.display=t.fn.dataTable.Responsive.display.childRowImmediate,e.responsive.details.renderer=t.fn.dataTable.Responsive.renderer.listHidden()):"modal"===e.responsive.details.display&&(e.responsive.details.display=t.fn.dataTable.Responsive.display.modal(),e.responsive.details.renderer=(l={tableClass:posts_table_params.table_class},l=t.extend({tableClass:""},l),function(e,a,i){var n=t.map(i,(function(t){return e.column(t.columnIndex).visible()?'<tr data-dt-row="'+t.rowIndex+'" data-dt-column="'+t.columnIndex+'"><td>'+(t.title?t.title+":":"")+"</td> <td>"+t.data+"</td></tr>":""})).join("");let s=t('<table class="'+l.tableClass+' dtr-details" width="100%"/>').append(n);r(s);let o=s.find(".posts-table-image-wrapper > a > img");return o.length&&(o.parent().parent().prepend(o),o.siblings("a").remove()),s}))),"lang_url"in posts_table_params&&(e.language={url:posts_table_params.lang_url}),e},d.prototype.getCurrentFilterItems=function(t){let e=this,a=e.$table.data("filters"),l=t.data("column");if(!a||!(l in a))return null;let i=a[l].terms;if(!i)return[];if(!e.config.serverSide){let a=e.getDataTable().column(t.data("searchColumn")+":name",{search:"applied"}).data();a.any()&&(i=o(i,a.join(" ").split(" ")))}return i},d.prototype.getDataTable=function(){return this.dataTable||this.init(),this.dataTable},d.prototype.init=function(){let t=this;return t.$table.trigger("preInit.ptp",[t]),t.config=t.buildConfig(),t.dataTable=t.$table.DataTable(t.config),t},d.prototype.initFilters=function(){let e=this,a=e.$table.data("filters");if(!a)return e;let l=t('<div class="posts-table-select-filters" id="'+e.id+'_select_filters" />'),i=0;posts_table_params.language.filterBy&&l.append('<label class="filter-label">'+posts_table_params.language.filterBy+"</label>");for(let n in a){let s={name:"ptp_filter_"+n,"data-tax":a[n].taxonomy,"data-column":n,"data-search-column":n+"_hfilter","aria-label":a[n].heading,"data-placeholder":a[n].heading};a[n].class&&(s.class=a[n].class);let r=t("<select/>").attr(s);e.refreshFilterItems(r),r.children().length<=1||(r.on("change.ptp",{table:e},u).appendTo(l),i++)}if(i>0){let t=e.$tableControls.find(".dataTables_filter");t.length?l.prependTo(t.closest(".posts-table-controls")):l.prependTo(e.$tableControls.filter(".posts-table-above"))}return e.$filters=e.$tableControls.find(".posts-table-select-filters select"),e},d.prototype.initPhotoswipe=function(){return"undefined"==typeof PhotoSwipe||"undefined"==typeof PhotoSwipeUI_Default||this.$table.on("click.ptp","td.child .posts-table-gallery__image a",b),this},d.prototype.initResetButton=function(){let e=this;if(!e.config.resetButton)return e;let a=t('<div class="posts-table-reset"><a class="reset" href="#">'+posts_table_params.language.resetButton+"</a></div>").on("click.ptp","a",{table:e},$),l=e.$tableControls.filter(".posts-table-above").children(".posts-table-select-filters, .dataTables_length, .dataTables_filter").eq(0);return l.length?l.append(a):e.$tableControls.filter(".posts-table-above").prepend(a),e},d.prototype.initSearchOnClick=function(){return this.config.clickFilter&&this.$table.on("click.ptp","a",{table:this},f),this},d.prototype.initSelect2=function(){let t=this;if(!p())return t;let e={dropdownCssClass:"posts-table-dropdown",dropdownParent:t.$tableWrapper};return t.$filters.length&&t.$filters.select2(Object.assign(e,{minimumResultsForSearch:5})),t.$tableControls.find(".dataTables_length select").select2(Object.assign(e,{minimumResultsForSearch:-1})),t},d.prototype.processAjaxData=function(){let e=this;if(!e.config.serverSide||!e.ajaxData.length)return;let a=e.$table.find("tbody tr");for(let l=0;l<e.ajaxData.length;l++)"__attributes"in e.ajaxData[l]&&a.eq(l).length&&t.each(e.ajaxData[l].__attributes,n(a.eq(l)));return e},d.prototype.refreshFilterItems=function(e){let a=this,l=a.$table.data("filters"),i=e.data("column"),n=e.val();return l&&i in l?(e.empty(),t('<option value="" />').text(l[i].heading).prependTo(e),s(e,a.getCurrentFilterItems(e)),e.val(n),a):a},d.prototype.scrollToTop=function(){let e=this,a=e.config.scrollOffset;if(!1!==a&&!isNaN(a)){let l=e.$tableWrapper.offset().top-a;e.hasAdminBar&&(l-=32),t("html,body").animate({scrollTop:l},300)}return e},d.prototype.showHidePagination=function(){let t=this;if(t.$pagination.length){let e=t.getDataTable().page.info();e&&e.pages<=1?t.$pagination.hide(0):t.$pagination.show()}return t},t.fn.postsTable=function(){return this.each((function(){new d(t(this)).init()}))},t((function(){"DataTable"in t.fn&&t.fn.DataTable.ext&&(t.fn.DataTable.ext.errMode="throw"),t("."+posts_table_params.table_class).postsTable()}))}(jQuery,window,document);